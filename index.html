<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>COPA PATOTA - Apostas</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .jogo-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .grafico-jogo {
      width: 250px;
      height: 150px;
    }
  </style>
</head>
<body>
  <div id="login-container" style="text-align: center; padding: 2rem;">
    <h2>Bem-vindo √† Copa Patota!</h2>
    <p>Fa√ßa login com sua conta Google para votar:</p>
    <button onclick="fazerLoginGoogle()">Entrar com Google</button>
  </div>

  <div class="container" style="display: none;">
    <h1>COPA PATOTA - Apostas</h1>
   
    <label for="apostador">Seu nome:</label>
    <input type="text" id="apostador" name="apostador" required placeholder="Digite seu nome" />

    <h2>Vote nos Vencedores dos Jogos</h2>
    <div class="jogos-multiplos">
      <h2>Aposta M√∫ltipla: Acertos nos 6 Jogos</h2>
      <form id="form-multipla">
        <div id="selecao-jogos-multiplos">
          <div class="jogo-container">
            <label>Jogo 1: CFC vs Monobolas
              <select name="jogo1">
                <option value="cfc">CFC</option>
                <option value="monobolas">Monobolas</option>
              </select>
            </label>
            <canvas id="grafico-jogo1" class="grafico-jogo"></canvas>
          </div>

          <div class="jogo-container">
            <label>Jogo 2: Chupiscos vs Estressados
              <select name="jogo2">
                <option value="chupiscos">Chupiscos</option>
                <option value="estressados">Estressados</option>
              </select>
            </label>
            <canvas id="grafico-jogo2" class="grafico-jogo"></canvas>
          </div>

          <div class="jogo-container">
            <label>Jogo 3: CFC vs Estressados
              <select name="jogo3">
                <option value="cfc">CFC</option>
                <option value="estressados">Estressados</option>
              </select>
            </label>
            <canvas id="grafico-jogo3" class="grafico-jogo"></canvas>
          </div>

          <div class="jogo-container">
            <label>Jogo 4: Chupiscos vs Monobolas
              <select name="jogo4">
                <option value="chupiscos">Chupiscos</option>
                <option value="monobolas">Monobolas</option>
              </select>
            </label>
            <canvas id="grafico-jogo4" class="grafico-jogo"></canvas>
          </div>

          <div class="jogo-container">
            <label>Jogo 5: Chupiscos vs CFC
              <select name="jogo5">
                <option value="chupiscos">Chupiscos</option>
                <option value="cfc">CFC</option>
              </select>
            </label>
            <canvas id="grafico-jogo5" class="grafico-jogo"></canvas>
          </div>

          <div class="jogo-container">
            <label>Jogo 6: Monobolas vs Estressados
              <select name="jogo6">
                <option value="monobolas">Monobolas</option>
                <option value="estressados">Estressados</option>
              </select>
            </label>
            <canvas id="grafico-jogo6" class="grafico-jogo"></canvas>
          </div>
        </div>
        <button type="submit" style="margin-top: 10px;">Confirmar Aposta M√∫ltipla</button>
      </form>
      <div class="resultado" id="resultado-multipla">
        Nenhuma aposta m√∫ltipla registrada ainda.
      </div>
    </div>

    <div class="final">
      <h2>Quem ser√° o Campe√£o da Final?</h2>
      <div class="jogo">
        <button onclick="votarFinal('cfc')">
          <img src="cabaco.jpg" alt="CFC Logo" class="team-logo" />CFC
        </button>
        <button onclick="votarFinal('estressados')">
          <img src="estressados.jpg" alt="Estressados FC Logo" class="team-logo" />Estressados FC
        </button>
        <button onclick="votarFinal('chupiscos')">
          <img src="chupiscos.jpg" alt="Chupisco FC Logo" class="team-logo" />Chupisco FC
        </button>
        <button onclick="votarFinal('monobolas')">
          <img src="monobolas.jpg" alt="Monobola RFC Logo" class="team-logo" />Monobola RFC
        </button>
      </div>
      <div class="resultado" id="final-resultado">
        Votos para o campe√£o: <br />
        CFC: <span id="final-cfc">0</span> |
        Estressados: <span id="final-estressados">0</span> |
        Chupiscos: <span id="final-chupiscos">0</span> |
        Monobolas: <span id="final-monobolas">0</span>
      </div>
      <h2 style="text-align:center;">Gr√°fico de Votos da Final</h2>
      <canvas id="graficoFinal" width="400" height="400"></canvas>
    </div>

    <h1>ELENCO</h1>
    <div class="tabela-times">
      <h2>üèÜ Tabela de Times Final</h2>
      <table>
        <thead>
          <tr>
            <th>Time</th>
            <th>Ataque</th>
            <th>Meio</th>
            <th>Defesa</th>
            <th>T</th>
            <th>Faltam</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td data-label="Time"><strong>CFC</strong></td>
            <td data-label="Ataque">Nicolau 9</td>
            <td data-label="Meio">Tururu 10, Felipe 7</td>
            <td data-label="Defesa">Romulo 14, Arthur 4</td>
            <td data-label="T">15</td>
            <td data-label="Faltam"><span class="status-completo">‚úÖ Completo</span></td>
          </tr>
          <tr>
            <td data-label="Time"><strong>Estressados FC</strong></td>
            <td data-label="Ataque">Julio 10</td>
            <td data-label="Meio">Rodriguinho 7, Gilberto 11</td>
            <td data-label="Defesa">Benjamim 5, Gordo 4</td>
            <td data-label="T">15</td>
            <td data-label="Faltam"><span class="status-completo">‚úÖ Completo</span></td>
          </tr>
          <tr>
            <td data-label="Time"><strong>Chupisco FC</strong></td>
            <td data-label="Ataque">Rafa 10</td>
            <td data-label="Meio">Heitor 7, <strong>Marinho</strong> 99</td>
            <td data-label="Defesa">Henryco 5, Kelvys 11</td>
            <td data-label="T">15</td>
            <td data-label="Faltam"><span class="status-completo">‚úÖ Completo</span></td>
          </tr>
          <tr>
            <td data-label="Time"><strong>Monobola RFC</strong></td>
            <td data-label="Ataque">Diego 9</td>
            <td data-label="Meio">Pedro 10, Nicolas 87</td>
            <td data-label="Defesa">Salsicha 11, Luiz Paulo 3</td>
            <td data-label="T">14.5</td>
            <td data-label="Faltam"><span class="status-completo">‚úÖ Completo</span></td>
          </tr>
        </tbody>
      </table>
    </div>

    <footer>
      ¬© 2025 COPA PATOTA. Todos os direitos reservados.
    </footer>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAPSO_BV6U0l2uJ9xdGtTg1CjQhUbUYv9Q",
      authDomain: "copapatota.firebaseapp.com",
      databaseURL: "https://copapatota-default-rtdb.firebaseio.com",
      projectId: "copapatota",
      storageBucket: "copapatota.appspot.com",
      messagingSenderId: "916525284122",
      appId: "1:916525284122:web:b03f134cdd375d3436caa3"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    // Controle do login
    function fazerLoginGoogle() {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider)
        .then(result => {
          document.getElementById('login-container').style.display = 'none';
          document.querySelector('.container').style.display = 'block';
          carregarDadosFinais();
          carregarGraficoFinal();
          carregarDadosMultiplos();
          carregarGraficosJogos();
        })
        .catch(error => {
          alert("Erro no login: " + error.message);
        });
    }

    // Votos para a final
    function votarFinal(time) {
      const user = auth.currentUser;
      if (!user) {
        alert("Fa√ßa login para votar!");
        return;
      }
      const uid = user.uid;
      const userName = document.getElementById('apostador').value.trim();
      if (!userName) {
        alert('Digite seu nome antes de votar na final.');
        return;
      }
      const votoRef = db.ref('final/' + time);
      votoRef.transaction(current => (current || 0) + 1);

      // Guardar voto individual para evitar votos m√∫ltiplos pode ser implementado aqui

      alert(`Voto registrado para ${time.toUpperCase()}!`);
      carregarDadosFinais();
      carregarGraficoFinal();
    }

    // Atualizar dados finais na tela
    function carregarDadosFinais() {
      const times = ['cfc', 'estressados', 'chupiscos', 'monobolas'];
      times.forEach(time => {
        db.ref('final/' + time).once('value').then(snapshot => {
          const votos = snapshot.val() || 0;
          document.getElementById('final-' + time).textContent = votos;
        });
      });
    }

    // Gr√°fico dos votos finais
    let graficoFinal;
    function carregarGraficoFinal() {
      const ctx = document.getElementById('graficoFinal').getContext('2d');
      if (graficoFinal) graficoFinal.destroy();

      db.ref('final').once('value').then(snapshot => {
        const data = snapshot.val() || {};
        const votos = {
          cfc: data.cfc || 0,
          estressados: data.estressados || 0,
          chupiscos: data.chupiscos || 0,
          monobolas: data.monobolas || 0
        };

        graficoFinal = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: ['CFC', 'Estressados', 'Chupiscos', 'Monobolas'],
            datasets: [{
              label: 'Votos',
              data: [votos.cfc, votos.estressados, votos.chupiscos, votos.monobolas],
              backgroundColor: ['#2ecc71', '#e74c3c', '#3498db', '#9b59b6']
            }]
          },
          options: {
            responsive: true,
            scales: {
              y: { beginAtZero: true, stepSize: 1 }
            }
          }
        });
      });
    }

    // --- Apostas M√∫ltiplas ---

    const jogosMultiplos = {
      jogo1: ['cfc', 'monobolas'],
      jogo2: ['chupiscos', 'estressados'],
      jogo3: ['cfc', 'estressados'],
      jogo4: ['chupiscos', 'monobolas'],
      jogo5: ['chupiscos', 'cfc'],
      jogo6: ['monobolas', 'estressados'],
    };

    function registrarApostaMultipla(event) {
      event.preventDefault();

      const user = auth.currentUser;
      if (!user) {
        alert("Fa√ßa login para apostar!");
        return;
      }

      const userName = document.getElementById('apostador').value.trim();
      if (!userName) {
        alert('Digite seu nome para registrar a aposta m√∫ltipla.');
        return;
      }

      const form = event.target;
      const aposta = {};
      for (let i = 1; i <= 6; i++) {
        const jogoKey = 'jogo' + i;
        const escolha = form[jogoKey].value;

        // Validar que a escolha existe no array de op√ß√µes do jogo
        if (!jogosMultiplos[jogoKey].includes(escolha)) {
          alert(`Escolha inv√°lida para o ${jogoKey}: ${escolha}`);
          return;
        }

        aposta[jogoKey] = escolha;
      }

      // Grava no Firebase: apostasMultiplas / [user.uid]
      db.ref('apostasMultiplas/' + user.uid).set({
        nome: userName,
        aposta: aposta,
        timestamp: Date.now()
      }).then(() => {
        document.getElementById('resultado-multipla').textContent = `Aposta m√∫ltipla registrada para ${userName}!`;
        carregarDadosMultiplos();
        carregarGraficosJogos();
      }).catch(err => {
        alert('Erro ao registrar aposta: ' + err.message);
      });
    }

    document.getElementById('form-multipla').addEventListener('submit', registrarApostaMultipla);

    // Carregar dados m√∫ltiplos e mostrar resumo simplificado (sem "undefined")
    function carregarDadosMultiplos() {
      const resultadoEl = document.getElementById('resultado-multipla');
      const apostasRef = db.ref('apostasMultiplas');

      apostasRef.once('value').then(snapshot => {
        const data = snapshot.val() || {};
        if (Object.keys(data).length === 0) {
          resultadoEl.textContent = "Nenhuma aposta m√∫ltipla registrada ainda.";
          return;
        }

        // S√≥ mostrar a √∫ltima aposta registrada
        const ultimas = Object.values(data).sort((a,b) => b.timestamp - a.timestamp)[0];
        if (ultimas) {
          resultadoEl.textContent = `√öltima aposta registrada para ${ultimas.nome}.`;
        }
      });
    }

    // Gr√°ficos individuais de cada jogo (contagem dos votos)
    const chartsJogos = {};

    function carregarGraficosJogos() {
      // Contar votos por time em cada jogo
      const votosJogos = {
        jogo1: {cfc: 0, monobolas: 0},
        jogo2: {chupiscos: 0, estressados: 0},
        jogo3: {cfc: 0, estressados: 0},
        jogo4: {chupiscos: 0, monobolas: 0},
        jogo5: {chupiscos: 0, cfc: 0},
        jogo6: {monobolas: 0, estressados: 0}
      };

      db.ref('apostasMultiplas').once('value').then(snapshot => {
        const apostas = snapshot.val() || {};
        Object.values(apostas).forEach(aposta => {
          for (let jogo in aposta.aposta) {
            const escolha = aposta.aposta[jogo];
            if (votosJogos[jogo] && votosJogos[jogo][escolha] !== undefined) {
              votosJogos[jogo][escolha]++;
            }
          }
        });

        // Atualizar gr√°ficos
        for (let i = 1; i <= 6; i++) {
          const jogoKey = 'jogo' + i;
          const ctx = document.getElementById('grafico-' + jogoKey).getContext('2d');

          if (chartsJogos[jogoKey]) chartsJogos[jogoKey].destroy();

          chartsJogos[jogoKey] = new Chart(ctx, {
            type: 'bar',
            data: {
              labels: jogosMultiplos[jogoKey].map(time => time.charAt(0).toUpperCase() + time.slice(1)),
              datasets: [{
                label: 'Votos',
                data: jogosMultiplos[jogoKey].map(time => votosJogos[jogoKey][time]),
                backgroundColor: ['#2ecc71', '#3498db']
              }]
            },
            options: {
              responsive: true,
              scales: {
                y: { beginAtZero: true, stepSize: 1 }
              },
              plugins: {
                legend: { display: false }
              }
            }
          });
        }
      });
    }

  </script>
</body>
</html>
