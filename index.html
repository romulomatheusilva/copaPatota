<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>COPA PATOTA - Apostas</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .jogo-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .grafico-jogo {
      width: 250px;
      height: 150px;
    }
  </style>
</head>
<body>
  <div id="login-container" style="text-align: center; padding: 2rem;">
    <h2>Bem-vindo √† Copa Patota!</h2>
    <p>Fa√ßa login com sua conta Google para votar:</p>
    <button onclick="fazerLoginGoogle()">Entrar com Google</button>
  </div>

  <div class="container" style="display: none;">
    <h1>COPA PATOTA - Apostas</h1>

    <label for="apostador">Seu nome:</label>
    <input type="text" id="apostador" name="apostador" required placeholder="Digite seu nome" />

    <h2>Vote nos Vencedores dos Jogos</h2>
    <div class="jogos-multiplos">
      <h2>Aposta M√∫ltipla: Acertos nos 6 Jogos</h2>
      <form id="form-multipla">
        <div id="selecao-jogos-multiplos">
          <!-- JOGOS -->
          <div class="jogo-container">
            <label>Jogo 1: CFC vs Monobolas
              <select name="jogo1">
                <option value="cfc">CFC</option>
                <option value="monobolas">Monobolas</option>
              </select>
            </label>
            <canvas id="grafico-jogo1" class="grafico-jogo"></canvas>
          </div>
          <div class="jogo-container">
            <label>Jogo 2: Chupiscos vs Estressados
              <select name="jogo2">
                <option value="chupiscos">Chupiscos</option>
                <option value="estressados">Estressados</option>
              </select>
            </label>
            <canvas id="grafico-jogo2" class="grafico-jogo"></canvas>
          </div>
          <div class="jogo-container">
            <label>Jogo 3: CFC vs Estressados
              <select name="jogo3">
                <option value="cfc">CFC</option>
                <option value="estressados">Estressados</option>
              </select>
            </label>
            <canvas id="grafico-jogo3" class="grafico-jogo"></canvas>
          </div>
          <div class="jogo-container">
            <label>Jogo 4: Chupiscos vs Monobolas
              <select name="jogo4">
                <option value="chupiscos">Chupiscos</option>
                <option value="monobolas">Monobolas</option>
              </select>
            </label>
            <canvas id="grafico-jogo4" class="grafico-jogo"></canvas>
          </div>
          <div class="jogo-container">
            <label>Jogo 5: Chupiscos vs CFC
              <select name="jogo5">
                <option value="chupiscos">Chupiscos</option>
                <option value="cfc">CFC</option>
              </select>
            </label>
            <canvas id="grafico-jogo5" class="grafico-jogo"></canvas>
          </div>
          <div class="jogo-container">
            <label>Jogo 6: Monobolas vs Estressados
              <select name="jogo6">
                <option value="monobolas">Monobolas</option>
                <option value="estressados">Estressados</option>
              </select>
            </label>
            <canvas id="grafico-jogo6" class="grafico-jogo"></canvas>
          </div>
        </div>
        <button type="submit" style="margin-top: 10px;">Confirmar Aposta M√∫ltipla</button>
      </form>
      <div class="resultado" id="resultado-multipla">
        Nenhuma aposta m√∫ltipla registrada ainda.
      </div>
    </div>

    <div class="final">
      <h2>Quem ser√° o Campe√£o da Final?</h2>
      <div class="jogo">
        <button onclick="votarFinal('cfc')">CFC</button>
        <button onclick="votarFinal('estressados')">Estressados</button>
        <button onclick="votarFinal('chupiscos')">Chupiscos</button>
        <button onclick="votarFinal('monobolas')">Monobolas</button>
      </div>
      <div class="resultado" id="final-resultado">
        Votos para o campe√£o: <br />
        CFC: <span id="final-cfc">0</span> |
        Estressados: <span id="final-estressados">0</span> |
        Chupiscos: <span id="final-chupiscos">0</span> |
        Monobolas: <span id="final-monobolas">0</span>
      </div>
      <canvas id="graficoFinal" width="400" height="400"></canvas>
    </div>

    <h1>ELENCO</h1>
    <div class="tabela-times">
      <h2>üèÜ Tabela de Times Final</h2>
      <!-- tabela times omitida pra espa√ßo -->
    </div>
    <footer>
      ¬© 2025 COPA PATOTA. Todos os direitos reservados.
    </footer>
  </div>

  <!-- JAVASCRIPT COMPLETO -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, set, get, onValue, push } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "SUA_API_KEY",
      authDomain: "SEU_DOMINIO.firebaseapp.com",
      databaseURL: "https://SEU_DATABASE_URL.firebaseio.com",
      projectId: "SEU_PROJECT_ID",
      storageBucket: "SEU_BUCKET.appspot.com",
      messagingSenderId: "SENDER_ID",
      appId: "SEU_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    const loginContainer = document.getElementById("login-container");
    const mainContainer = document.querySelector(".container");

    function fazerLoginGoogle() {
      signInWithPopup(auth, provider).catch(console.error);
    }
    window.fazerLoginGoogle = fazerLoginGoogle;

    onAuthStateChanged(auth, (user) => {
      if (user) {
        loginContainer.style.display = "none";
        mainContainer.style.display = "block";
      }
    });

    // MULTIPLA
    const formMultipla = document.getElementById("form-multipla");
    formMultipla.addEventListener("submit", (e) => {
      e.preventDefault();
      const nome = document.getElementById("apostador").value.trim();
      if (!nome) return alert("Digite seu nome");

      const apostas = {};
      for (let i = 1; i <= 6; i++) {
        apostas[`jogo${i}`] = formMultipla[`jogo${i}`].value;
      }
      push(ref(db, "apostasMultipla"), { nome, ...apostas }).then(() => {
        alert("Aposta enviada!");
        formMultipla.reset();
        atualizarResultadosMultipla();
      });
    });

    function atualizarResultadosMultipla() {
      get(ref(db, "apostasMultipla")).then((snapshot) => {
        if (!snapshot.exists()) return;
        const contagem = Array(6).fill(0).map(() => ({}));
        Object.values(snapshot.val()).forEach(aposta => {
          for (let i = 1; i <= 6; i++) {
            const v = aposta[`jogo${i}`];
            contagem[i - 1][v] = (contagem[i - 1][v] || 0) + 1;
          }
        });
        contagem.forEach((jogo, i) => {
          const ctx = document.getElementById(`grafico-jogo${i + 1}`).getContext("2d");
          new Chart(ctx, {
            type: 'bar',
            data: {
              labels: Object.keys(jogo),
              datasets: [{
                label: 'Votos',
                data: Object.values(jogo),
                backgroundColor: ['#1e88e5', '#f4511e']
              }]
            },
            options: { responsive: false, plugins: { legend: { display: false } } }
          });
        });
      });
    }

    function votarFinal(time) {
      const user = auth.currentUser;
      if (!user) return alert("Fa√ßa login para votar");
      set(ref(db, `votosFinal/${user.uid}`), time).then(() => alert("Voto registrado!"));
    }
    window.votarFinal = votarFinal;

    function atualizarFinal() {
      const contagem = { cfc: 0, estressados: 0, chupiscos: 0, monobolas: 0 };
      onValue(ref(db, "votosFinal"), (snapshot) => {
        if (snapshot.exists()) {
          Object.values(snapshot.val()).forEach(voto => contagem[voto]++);
        }
        document.getElementById("final-cfc").textContent = contagem.cfc;
        document.getElementById("final-estressados").textContent = contagem.estressados;
        document.getElementById("final-chupiscos").textContent = contagem.chupiscos;
        document.getElementById("final-monobolas").textContent = contagem.monobolas;

        const ctx = document.getElementById("graficoFinal").getContext("2d");
        new Chart(ctx, {
          type: 'pie',
          data: {
            labels: ['CFC', 'Estressados', 'Chupiscos', 'Monobolas'],
            datasets: [{
              data: Object.values(contagem),
              backgroundColor: ['#2196f3', '#e53935', '#43a047', '#fb8c00']
            }]
          }
        });
      });
    }

    atualizarResultadosMultipla();
    atualizarFinal();
  </script>
</body>
</html>
