<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>COPA PATOTA - Apostas</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .jogo-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .grafico-jogo {
      width: 250px;
      height: 150px;
    }
  </style>
</head>
<body>
  <div id="login-container" style="text-align: center; padding: 2rem;">
    <h2>Bem-vindo √† Copa Patota!</h2>
    <p>Fa√ßa login com sua conta Google para votar:</p>
<!-- <button onclick="fazerLoginGoogle()">Entrar com Google</button> -->
    <button id="loginBtn" onclick="fazerLoginGoogle()">Entrar com Google</button>

  </div>

  <div class="container" style="display: none;">
    <h1>COPA PATOTA - Apostas</h1>
   
    <label for="apostador">Seu nome:</label>
    <input type="text" id="apostador" name="apostador" required placeholder="Digite seu nome" />

    <h2>Vote nos Vencedores dos Jogos</h2>
    <div class="jogos-multiplos">
      <h2>Aposta M√∫ltipla: Acertos nos 6 Jogos</h2>
      <form id="form-multipla">
        <div id="selecao-jogos-multiplos">
          <div class="jogo-container">
            <label>Jogo 1: CFC vs Monobolas
              <select name="jogo1">
                <option value="cfc">CFC</option>
                <option value="monobolas">Monobolas</option>
              </select>
            </label>
            <canvas id="grafico-jogo1" class="grafico-jogo"></canvas>
          </div>

          <div class="jogo-container">
            <label>Jogo 2: Chupiscos vs Estressados
              <select name="jogo2">
                <option value="chupiscos">Chupiscos</option>
                <option value="estressados">Estressados</option>
              </select>
            </label>
            <canvas id="grafico-jogo2" class="grafico-jogo"></canvas>
          </div>

          <div class="jogo-container">
            <label>Jogo 3: CFC vs Estressados
              <select name="jogo3">
                <option value="cfc">CFC</option>
                <option value="estressados">Estressados</option>
              </select>
            </label>
            <canvas id="grafico-jogo3" class="grafico-jogo"></canvas>
          </div>

          <div class="jogo-container">
            <label>Jogo 4: Chupiscos vs Monobolas
              <select name="jogo4">
                <option value="chupiscos">Chupiscos</option>
                <option value="monobolas">Monobolas</option>
              </select>
            </label>
            <canvas id="grafico-jogo4" class="grafico-jogo"></canvas>
          </div>

          <div class="jogo-container">
            <label>Jogo 5: Chupiscos vs CFC
              <select name="jogo5">
                <option value="chupiscos">Chupiscos</option>
                <option value="cfc">CFC</option>
              </select>
            </label>
            <canvas id="grafico-jogo5" class="grafico-jogo"></canvas>
          </div>

          <div class="jogo-container">
            <label>Jogo 6: Monobolas vs Estressados
              <select name="jogo6">
                <option value="monobolas">Monobolas</option>
                <option value="estressados">Estressados</option>
              </select>
            </label>
            <canvas id="grafico-jogo6" class="grafico-jogo"></canvas>
          </div>
        </div>
        <button type="submit" style="margin-top: 10px;">Confirmar Aposta M√∫ltipla</button>
      </form>
      <div class="resultado" id="resultado-multipla">
        Nenhuma aposta m√∫ltipla registrada ainda.
      </div>
    </div>

    <div class="final">
      <h2>Quem ser√° o Campe√£o da Final?</h2>
      <div class="jogo">
        <button onclick="votarFinal('cfc')">
          <img src="cabaco.jpg" alt="CFC Logo" class="team-logo" />CFC
        </button>
        <button onclick="votarFinal('estressados')">
          <img src="estressados.jpg" alt="Estressados FC Logo" class="team-logo" />Estressados FC
        </button>
        <button onclick="votarFinal('chupiscos')">
          <img src="chupisco.jpg" alt="Chupisco FC Logo" class="team-logo" />Chupisco FC
        </button>
        <button onclick="votarFinal('monobolas')">
          <img src="monobola.jpg" alt="Monobola RFC Logo" class="team-logo" />Monobola RFC
        </button>
      </div>
      <div class="resultado" id="final-resultado">
        Votos para o campe√£o: <br />
        CFC: <span id="final-cfc">0</span> |
        Estressados: <span id="final-estressados">0</span> |
        Chupiscos: <span id="final-chupiscos">0</span> |
        Monobolas: <span id="final-monobolas">0</span>
      </div>
      <h2 style="text-align:center;">Gr√°fico de Votos da Final</h2>
      <canvas id="graficoFinal" width="400" height="400"></canvas>
    </div>

    <h1>ELENCO</h1>
    <div class="tabela-times">
      <h2>üèÜ Tabela de Times Final</h2>
      <table>
        <thead>
          <tr>
            <th>Time</th>
            <th>Ataque</th>
            <th>Meio</th>
            <th>Defesa</th>
            <th>T</th>
            <th>Faltam</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td data-label="Time"><strong>CFC</strong></td>
            <td data-label="Ataque">Nicolau 9</td>
            <td data-label="Meio">Tururu 10, Felipe 7</td>
            <td data-label="Defesa">Romulo 14, Arthur 4</td>
            <td data-label="T">15</td>
            <td data-label="Faltam"><span class="status-completo">‚úÖ Completo</span></td>
          </tr>
          <tr>
            <td data-label="Time"><strong>Estressados FC</strong></td>
            <td data-label="Ataque">Julio 10</td>
            <td data-label="Meio">Rodriguinho 7, Gilberto 11</td>
            <td data-label="Defesa">Benjamim 5, Gordo 4</td>
            <td data-label="T">15</td>
            <td data-label="Faltam"><span class="status-completo">‚úÖ Completo</span></td>
          </tr>
          <tr>
            <td data-label="Time"><strong>Chupisco FC</strong></td>
            <td data-label="Ataque">Rafa 10</td>
            <td data-label="Meio">Heitor 7, <strong>Marinho</strong> 99</td>
            <td data-label="Defesa">Henryco 5, Kelvys 11</td>
            <td data-label="T">15</td>
            <td data-label="Faltam"><span class="status-completo">‚úÖ Completo</span></td>
          </tr>
          <tr>
            <td data-label="Time"><strong>Monobola RFC</strong></td>
            <td data-label="Ataque">Diego 9</td>
            <td data-label="Meio">Pedro 10, Nicolas 87</td>
            <td data-label="Defesa">Salsicha 11, Luiz Paulo 3</td>
            <td data-label="T">14.5</td>
            <td data-label="Faltam"><span class="status-completo">‚úÖ Completo</span></td>
          </tr>
        </tbody>
      </table>
    </div>

    <footer>
      ¬© 2025 COPA PATOTA. Todos os direitos reservados.
    </footer>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
   <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAPSO_BV6U0l2uJ9xdGtTg1CjQhUbUYv9Q",
      authDomain: "copapatota.firebaseapp.com",
      databaseURL: "https://copapatota-default-rtdb.firebaseio.com",
      projectId: "copapatota",
      storageBucket: "copapatota.appspot.com",
      messagingSenderId: "916525284122",
      appId: "1:916525284122:web:b03f134cdd375d3436caa3"
    };
  
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();
  
    let isLoggingIn = false;

  async function fazerLoginGoogle() {
  if (isLoggingIn) return;
  isLoggingIn = true;

  const loginBtn = document.getElementById('loginBtn');
  loginBtn.disabled = true;
  loginBtn.innerText = "Conectando...";

  const provider = new firebase.auth.GoogleAuthProvider(); // <- compat√≠vel com vers√£o compat

  try {
    await firebase.auth().signInWithPopup(provider); // <- tamb√©m compat√≠vel
    // O login ser√° detectado pelo onAuthStateChanged
  } catch (error) {
    console.error("Erro no login:", error);
    
    if (error.code === "auth/cancelled-popup-request") {
      alert("Voc√™ j√° est√° tentando se conectar. Aguarde ou feche a outra janela de login.");
    } else if (error.code === "auth/popup-closed-by-user") {
      alert("Voc√™ fechou a janela de login. Tente novamente.");
    } else {
      alert("Erro ao fazer login: " + error.message);
    }
  } finally {
    loginBtn.disabled = false;
    loginBtn.innerText = "Entrar com Google";
    isLoggingIn = false;
  }
}

  
    function votarFinal(time) {
      const user = auth.currentUser;
      if (!user) {
        alert("Fa√ßa login para votar!");
        return;
      }
      const userName = document.getElementById('apostador').value.trim();
      if (!userName) {
        alert('Digite seu nome antes de votar na final.');
        return;
      }
  
      const votoRef = db.ref('votacaoFinal/' + time);
      votoRef.transaction(current => (current || 0) + 1);
  
      alert(`Voto registrado para ${time.toUpperCase()}!`);
      carregarDadosFinais();
      carregarGraficoFinal();
    }
  
    function carregarDadosFinais() {
      const times = ['cfc', 'estressados', 'chupisco', 'monobola'];
      times.forEach(time => {
        db.ref('votacaoFinal/' + time).once('value').then(snapshot => {
          const votos = snapshot.val() || 0;
          document.getElementById('final-' + time).textContent = votos;
        });
      });
    }
  
    let graficoFinal;
    function carregarGraficoFinal() {
      const ctx = document.getElementById('graficoFinal').getContext('2d');
      if (graficoFinal) graficoFinal.destroy();
  
      db.ref('votacaoFinal').once('value').then(snapshot => {
        const data = snapshot.val() || {};
        const votos = {
          cfc: data.cfc || 0,
          estressados: data.estressados || 0,
          chupisco: data.chupisco || 0,
          monobola: data.monobola || 0
        };
  
        graficoFinal = new Chart(ctx, {
          type: 'pie',
          data: {
            labels: ['CFC', 'Estressados', 'Chupisco', 'Monobola'],
            datasets: [{
              label: 'Votos',
              data: [votos.cfc, votos.estressados, votos.chupisco, votos.monobola],
              backgroundColor: ['#0B2345', '#FFD700', '#7D7D7D', '#000000']
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: true }
            }
          }
        });
      });
    }
  
    const jogosMultiplos = {
      jogo1: ['cfc', 'monobolas'],
      jogo2: ['chupiscos', 'estressados'],
      jogo3: ['cfc', 'estressados'],
      jogo4: ['chupiscos', 'monobolas'],
      jogo5: ['chupiscos', 'cfc'],
      jogo6: ['monobolas', 'estressados'],
    };
  
    function registrarApostaMultipla(event) {
      event.preventDefault();
  
      const user = auth.currentUser;
      if (!user) {
        alert("Fa√ßa login para apostar!");
        return;
      }
  
      const userName = document.getElementById('apostador').value.trim();
      if (!userName) {
        alert('Digite seu nome para registrar a aposta m√∫ltipla.');
        return;
      }
  
      const form = event.target;
      const aposta = {};
      for (let i = 1; i <= 6; i++) {
        const jogoKey = 'jogo' + i;
        const escolha = form[jogoKey].value;
  
        if (!jogosMultiplos[jogoKey].includes(escolha)) {
          alert(`Escolha inv√°lida para o ${jogoKey}: ${escolha}`);
          return;
        }
  
        aposta[jogoKey] = escolha;
      }
  
           db.ref('apostasMultiplas').push({
        nome: userName,
        aposta: aposta,
        timestamp: Date.now()
      

      }).then(() => {
        document.getElementById('resultado-multipla').textContent = `Aposta m√∫ltipla registrada para ${userName}!`;
        carregarDadosMultiplos();
      }).catch(err => {
        alert('Erro ao registrar aposta: ' + err.message);
      });
    }
  
    document.getElementById('form-multipla').addEventListener('submit', registrarApostaMultipla);
  
    function carregarDadosMultiplos() {
      const resultadoEl = document.getElementById('resultado-multipla');
      const apostasRef = db.ref('apostasMultiplas');
  
      apostasRef.once('value').then(snapshot => {
        const data = snapshot.val() || {};
        if (Object.keys(data).length === 0) {
          resultadoEl.textContent = "Nenhuma aposta m√∫ltipla registrada ainda.";
          return;
        }
  
        const ultimas = Object.values(data).sort((a,b) => b.timestamp - a.timestamp)[0];
        if (ultimas) {
          resultadoEl.textContent = `√öltima aposta registrada para ${ultimas.nome}.`;
        }
      });
    }
  
    const chartsJogos = {};
    const coresTimes = {
      cfc: '#0B2345',
      monobolas: '#000000',
      chupiscos: '#7D7D7D',
      estressados: '#FFD700'
    };
  
    function atualizarGraficosJogos(apostas) {
      const votosJogos = {
        jogo1: {cfc: 0, monobolas: 0},
        jogo2: {chupiscos: 0, estressados: 0},
        jogo3: {cfc: 0, estressados: 0},
        jogo4: {chupiscos: 0, monobolas: 0},
        jogo5: {chupiscos: 0, cfc: 0},
        jogo6: {monobolas: 0, estressados: 0}
      };
  
      Object.values(apostas).forEach(aposta => {
        for (let jogo in aposta.aposta) {
          const escolha = aposta.aposta[jogo];
          if (votosJogos[jogo] && votosJogos[jogo][escolha] !== undefined) {
            votosJogos[jogo][escolha]++;
          }
        }
      });
  
      for (let i = 1; i <= 6; i++) {
        const jogoKey = 'jogo' + i;
        const ctx = document.getElementById('grafico-' + jogoKey).getContext('2d');
  
        const labels = Object.keys(votosJogos[jogoKey]).map(time => time.charAt(0).toUpperCase() + time.slice(1));
        const dataValues = Object.values(votosJogos[jogoKey]);
        const backgroundColors = Object.keys(votosJogos[jogoKey]).map(time => coresTimes[time]);
  
        if (chartsJogos[jogoKey]) {
          chartsJogos[jogoKey].data.datasets[0].data = dataValues;
          chartsJogos[jogoKey].update();
        } else {
          chartsJogos[jogoKey] = new Chart(ctx, {
            type: 'pie',
            data: {
              labels: labels,
              datasets: [{
                label: 'Votos',
                data: dataValues,
                backgroundColor: backgroundColors
              }]
            },
            options: {
              responsive: true,
              plugins: {
                legend: { display: true }
              }
            }
          });
        }
      }
    }
  
    function configurarListenerApostasMultiplas() {
      db.ref('apostasMultiplas').on('value', snapshot => {
        const apostas = snapshot.val() || {};
        atualizarGraficosJogos(apostas);
      });
    }
</script>

</body>
</html>
